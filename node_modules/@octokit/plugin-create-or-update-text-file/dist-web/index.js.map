{"version":3,"file":"index.js","sources":["../dist-src/utils.js","../dist-src/get-file-content.js","../dist-src/compose-create-or-update-text-file.js","../dist-src/version.js","../dist-src/index.js"],"sourcesContent":["/* istanbul ignore file */\n// universal implementation of nodeUtf8ToBase64/nodeBase64ToUtf8 methods for browsers, Node, and Deno.\n//\n// - good docs on base64\n//   https://developer.mozilla.org/en-US/docs/Glossary/Base64\n// - great insights on why escape/unescape is needed\n//   https://stackoverflow.com/questions/30631927/converting-to-base64-in-javascript-without-deprecated-escape-call\n//\n// Known problem with atob/btoa:\n// https://github.com/octokit/plugin-create-or-update-text-file.js/issues/15\nconst isNode = globalThis.process &&\n    globalThis.process.release &&\n    globalThis.process.release.name;\nfunction browserUtf8ToBase64(data) {\n    return btoa(unescape(encodeURIComponent(data)));\n}\nfunction browserBase64ToUtf8(data) {\n    return decodeURIComponent(escape(atob(data)));\n}\nfunction nodeUtf8ToBase64(data) {\n    return Buffer.from(data, \"utf-8\").toString(\"base64\");\n}\nfunction nodeBase64ToUtf8(data) {\n    return Buffer.from(data, \"base64\").toString(\"utf-8\");\n}\nexport const utf8ToBase64 = isNode ? nodeUtf8ToBase64 : browserUtf8ToBase64;\nexport const base64ToUtf8 = isNode ? nodeBase64ToUtf8 : browserBase64ToUtf8;\n","import { RequestError } from \"@octokit/request-error\";\nimport { base64ToUtf8 } from \"./utils\";\n/**\n * Normalizes the retrival of a repository file content.\n *\n * The \"Get repository content\" API can respond in 4 different ways depending\n * on what exists at the given path\n *\n * - An array of folder item objects\n * - An object with type = symlink\n * - An object with type = submodule\n * - An object with type = file\n *\n * We are only interested in the last type, and throw errors in all other cases\n *\n * @see https://docs.github.com/en/rest/reference/repos#get-repository-content\n * @param octokit Octokit instance\n * @param options\n */\nexport async function getFileContents(octokit, options) {\n    const route = \"GET /repos/{owner}/{repo}/contents/{path}\";\n    const requestOptions = octokit.request.endpoint(route, options);\n    const { data } = await octokit\n        .request(route, options)\n        .catch((error) => {\n        /* istanbul ignore if */\n        if (error.status !== 404)\n            throw error;\n        return {\n            data: {\n                content: null,\n                type: \"\",\n                sha: \"\",\n            },\n        };\n    });\n    if (Array.isArray(data)) {\n        throw new RequestError(`[@octokit/plugin-create-or-update-text-file] ${requestOptions.url} is a directory`, 403, {\n            request: requestOptions,\n        });\n    }\n    if (!(\"sha\" in data && \"content\" in data)) {\n        throw new RequestError(`[@octokit/plugin-create-or-update-text-file] ${requestOptions.url} is not a file, but a ${data.type}`, 403, {\n            request: requestOptions,\n        });\n    }\n    if (data.content === null) {\n        return {\n            content: null,\n        };\n    }\n    try {\n        return {\n            content: base64ToUtf8(data.content),\n            sha: data.sha,\n        };\n    }\n    catch (error) {\n        /* istanbul ignore next */\n        if (error.message !== \"URI malformed\")\n            throw error;\n        /* istanbul ignore next error is only thrown in browsers, not node. */\n        throw new RequestError(`[@octokit/plugin-create-or-update-text-file] ${requestOptions.url} is a binary file, only text files are supported`, 403, {\n            request: requestOptions,\n        });\n    }\n}\n","import { getFileContents } from \"./get-file-content\";\nimport { utf8ToBase64 } from \"./utils\";\n/**\n *\n * @param octokit Octokit instance\n * @param options\n */\nexport async function composeCreateOrUpdateTextFile(octokit, options) {\n    const { content: contentOrFn, message, committer, author, ...getOptions } = options;\n    const currentFile = await getFileContents(octokit, getOptions);\n    // normalize content\n    const content = typeof contentOrFn === \"function\"\n        ? await contentOrFn({\n            exists: currentFile.content !== null,\n            content: currentFile.content,\n        })\n        : contentOrFn;\n    // do nothing if there are no changes\n    if (content === currentFile.content) {\n        return {\n            updated: false,\n            deleted: false,\n            data: {},\n            headers: {},\n        };\n    }\n    // delete file if it exists and new content is `null`\n    if (currentFile.sha && content === null) {\n        // https://docs.github.com/en/rest/reference/repos#delete-a-file\n        const response = await octokit.request(\"DELETE /repos/{owner}/{repo}/contents/{path}\", {\n            ...getOptions,\n            message,\n            sha: currentFile.sha,\n        });\n        return {\n            ...response,\n            updated: true,\n            deleted: true,\n        };\n    }\n    // update file to new content\n    // https://docs.github.com/en/rest/reference/repos#create-or-update-file-contents\n    const response = await octokit.request(\"PUT /repos/{owner}/{repo}/contents/{path}\", {\n        ...getOptions,\n        message,\n        ...currentFile,\n        content: utf8ToBase64(content),\n    });\n    return {\n        ...response,\n        updated: true,\n        deleted: false,\n        content: content,\n    };\n}\n","export const VERSION = \"1.0.2\";\n","import { composeCreateOrUpdateTextFile } from \"./compose-create-or-update-text-file\";\nimport { VERSION } from \"./version\";\nexport { composeCreateOrUpdateTextFile } from \"./compose-create-or-update-text-file\";\n/**\n * @param octokit Octokit instance\n */\nexport function createOrUpdateTextFile(octokit) {\n    return {\n        createOrUpdateTextFile(options) {\n            return composeCreateOrUpdateTextFile(octokit, options);\n        },\n    };\n}\ncreateOrUpdateTextFile.VERSION = VERSION;\n"],"names":[],"mappings":"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"}